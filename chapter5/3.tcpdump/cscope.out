cscope 15 $HOME/Github/Unp-txh/chapter5/3.tcpdump -q 0000000074 0000002197
	@cli.c

1 
	~"u≈.h
"

3 
	$°r_˛i
(
FILE
 *
Â
,
£rsock
)

5 
£ndbuf
[
MAXLINE
],
ªcvbuf
[MAXLINE];

6 
	`Fgës
(
£ndbuf
,
MAXLINE
,
Â
Ë!
NULL
){

7 
	`Wrôí
(
£rsock
,
£ndbuf
,1);

8 
	`¶ìp
(1);

9 
	`Wrôí
(
£rsock
,
£ndbuf
+1,
	`°æí
(sendbuf)-1);

10 if(
	`Ródlöe
(
£rsock
,
ªcvbuf
,
MAXLINE
) == 0){

11 
	`îr_quô
("str_cli:serverÅerminate");

13 
	`Fputs
(
ªcvbuf
,
°dout
);

15 
	}
}

18 
	$maö
(
¨gc
,*
¨gv
[])

20 if(
¨gc
 < 2)

21 
	`îr_quô
("usage cli IPAddress");

23 
sockaddr_ö
 
£rvsock
;

24 
sock
;

25 
i
;

26 
sock
 = 
	`Sockë
(
AF_INET
,
SOCK_STREAM
,0);

28 
	`bzîo
(&
£rvsock
,(servsock));

30 
£rvsock
.
sö_Ámûy
 = 
AF_INET
;

31 
£rvsock
.
sö_p‹t
 = 
	`ht⁄s
(
SERV_PORT
);

32 
	`I√t_±⁄
(
AF_INET
,
¨gv
[1],&
£rvsock
.
sö_addr
);

34 
	`C⁄√˘
(
sock
,(
SA
*)&
£rvsock
,(servsock));

36 
	`°r_˛i
(
°dö
,
sock
);

37 
	`exô
(0);

38 
	}
}

	@ser.c

1 
	~"u≈.h
"

4 
	$sig_chûd
(
signo
)

6 
pid_t
 
pid
;

7 
°©
;

8  (
pid
 = 
	`waôpid
(-1,&
°©
,
WNOHANG
))>0)

10 
	`¥ötf
("chûd %dÅîmö©e\n",
pid
);

13 
	}
}

15 
	$°r_echo
(
sockfd
)

17 
ssize_t
 
n
;

18 
buf
[
MAXLINE
];

19 
agaö
:

20  (
n
 = 
	`ªad
(
sockfd
,
buf
,
MAXLINE
)) > 0){

21 
	`Wrôí
(
sockfd
,
buf
,
n
);

23 if(
n
 < 0 && 
î∫o
 =
EINTR
)

24 
agaö
;

25 if(
n
 < 0)

26 
	`îr_sys
("str_echo:readÉrror");

27 
	}
}

30 
	$maö
()

32 
sock
,
˛isock
;

33 
sockaddr_ö
 
£rvaddr
,
˛üddr
;

34 
sockÀn_t
 
Àn
 = (
sockaddr_ö
);

35 
pid_t
 
chûdpid
;

36 
sock
 = 
	`Sockë
(
AF_INET
,
SOCK_STREAM
,0);

38 
	`bzîo
(&
£rvaddr
,
Àn
);

39 
£rvaddr
.
sö_Ámûy
 = 
AF_INET
;

40 
£rvaddr
.
sö_p‹t
 = 
	`ht⁄s
(
SERV_PORT
);

41 
£rvaddr
.
sö_addr
.
s_addr
 = 
	`ht⁄l
(
INADDR_ANY
);

43 
	`Sig«l
(
SIGCHLD
,
sig_chûd
);

44 
	`Böd
(
sock
,(
SA
*)&
£rvaddr
,
Àn
);

45 
	`Li°í
(
sock
,
LISTENQ
);

48 
˛ûí
 = (
˛üddr
);

49 if((
˛isock
 = 
	`ac˚±
(
sock
,(
SA
* )&
˛üddr
,&
˛ûí
)) < 0)

51 if(
î∫o
 =
EINTR
)

54 
	`îr_sys
("acceptÉrror");

56 
chûdpid
 = 
	`F‹k
();

57 if(
chûdpid
 == 0)

59 
	`Clo£
(
sock
);

60 
	`°r_echo
(
˛isock
);

61 
	`exô
(0);

63 
	`Clo£
(
˛isock
);

65 
	`exô
(0);

66 
	}
}

	@
1
.
1
/usr/include
2
12
cli.c
ser.c
